# Get climate entities that have a heating need
{% set heating_need = [] %}
{% set heating_need = namespace(rooms=[],delta=[]) %}
{% for room in ['climate.bathroom_radiator_thermostat', 'climate.bedroom_radiator_thermostat', 'climate.closet_radiator_thermostat', 'climate.kids_room_radiator_thermostat']  %}
  {% if states(room) == 'heat' %}
    {% set current = state_attr(room, 'current_temperature') %}
    {% set setpoint = state_attr(room, 'temperature') %}
    {% set delta = setpoint - current %}
    {% set heating_need.rooms = heating_need.rooms + [room] %}
    {% set heating_need.delta = heating_need.delta + [delta] %}
  {% endif %}
{% endfor %}

# Find highest delta
{% set highest_delta = namespace(current_central=-1000, room='None') %}
{% if heating_need.rooms|count > 0 %}
  {% for i in range(heating_need.rooms|count) %}
    {% if highest_delta.current_central < heating_need.delta[i] %}
      {% set highest_delta.current_central = heating_need.delta[i] %}
      {% set highest_delta.room = heating_need.rooms[i] %}
    {% endif %}
  {% endfor %}
  {% set result_delta = highest_delta.current_central %}
  {% set result_room = highest_delta.room %}
{% else %}
  {% set result_delta = 0 %}
  {% set result_room = "None" %}
{% endif %}

{{ result_delta }}
{{ result_room }}
