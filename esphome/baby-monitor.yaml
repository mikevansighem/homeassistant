################################################################################
# SUBSTITUTIONS
################################################################################

substitutions:
  device_name: baby-monitor
  upper_devicename: Baby-monitor
  device_description: "Monitors noise in the baby her room."

###############################################################################
# GENERAL
###############################################################################

esphome:
  name: $device_name
  comment: "${device_description}"
  platform: ESP32
  board: esp32dev

# Enable logging
logger:

# Enable ota update with a password
ota:
  password: !secret ota_password

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "${device_name} fallback"
    password: !secret esphome_fallback_password
    ap_timeout: 15s

captive_portal:

# Enable webserver
web_server:
  port: 80

# Enable Home Assistant API
api:
  encryption:
    key: !secret encryption_key

binary_sensor:

  - platform: status
    name: "${upper_devicename} status"
    icon: "mdi:wifi"

# Example configuration entry
sensor:
  # Sound sensor
  - platform: adc
    id: adc_lyd
    pin: GPIO36
    name: "Voltage"
    update_interval: 100ms
    attenuation: auto
    # Don't send sound sensor readings to HA
    internal: true

  # Sound level measurement based upon sound sensor
  - platform: ct_clamp
    sensor: adc_lyd
    name: "Sound level"
    sample_duration: 500ms
    update_interval: 500ms
    filters:
      # Consider everything below threshold to be zero
      # You may adjust threshold and delta to your liking
      - lambda: |-
          float THRESHOLD = 0.05;
          if (x < THRESHOLD) {
            return 0;
          } else {
            return x;
          }
      # When above threshold, only send results when more than "delta" difference since last time
      # This reduces the amount of data sent to HA so your log doesn't fill up
      - delta: 0.005

